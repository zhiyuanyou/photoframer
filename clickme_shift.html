<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Results of PhotoFramer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
            margin-bottom: 0;
            display: none; /* hidden until a status is shown */
        }

        .controls h3 {
            margin-bottom: 15px;
            color: #4a5568;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .status {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }

        .status.loading {
            background: #fef7cd;
            color: #b45309;
            display: block;
        }

        .status.error {
            background: #fecaca;
            color: #dc2626;
            display: block;
        }

        .status.success {
            background: #d1fae5;
            color: #059669;
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-top: 20px;
        }

        .sample-card {
            background: white;
            border-radius: 15px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            min-height: auto;
        }

        .sample-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .sample-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f5f9;
            gap: 15px;
        }

        .sample-id {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
            word-break: break-all;
            line-height: 1.4;
            flex: 1;
            min-width: 0;
            position: relative;
            cursor: help;
        }

        .sample-id:hover::after {
            content: attr(title);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            white-space: pre-wrap;
            z-index: 10000;
            max-width: 80vw;
            word-break: break-all;
            line-height: 1.4;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sample-id-truncated {
            display: inline-block;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .image-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .image-wrapper {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
        }

        .image-wrapper img {
            width: 100%;
            height: auto;
            object-fit: contain;
            transition: transform 0.3s;
            cursor: default;
            max-height: 300px;
        }

        .image-wrapper:hover img {
            transform: none;
        }

        .image-label {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .reason-container {
            background: #ffffff;
            color: #000000;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-top: 20px;
        }

        .reason-title {
            font-weight: 600;
            color: #000000;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .reason-text {
            color: #2d3748;
            line-height: 1.6;
            font-size: 16px;
            white-space: pre-wrap;
        }

        .reason-embed {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .reason-iframe {
            width: 100%;
            height: 160px;
            border: 0;
            background: #fff;
        }

        .reason-input {
            width: 100%;
            min-height: 160px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            resize: vertical;
            font-size: 16px;
            font-family: inherit;
            margin-top: 10px;
            line-height: 1.6;
            background: #ffffff;
            color: #000000;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 0;
            width: 90%;
            max-width: 1200px;
            top: 50%;
            transform: translateY(-50%);
        }

        .modal img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #667eea;
        }

        @media (max-width: 1200px) {
            .results-grid {
                grid-template-columns: 1fr;
                gap: 25px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .image-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }

            .sample-card {
                min-height: auto;
                padding: 20px;
            }

            .image-wrapper img {
                max-height: 250px;
            }

            .reason-input {
                min-height: 160px;
                font-size: 15px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¥¯ Shift Results of PhotoFramer </h1>
        </div>

        <div class="controls">
            <div id="status" class="status"></div>
        </div>

        <div id="resultsContainer"></div>
    </div>

    <!-- Modal for full-size images -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <script>
        let currentResults = [];
        const DEFAULT_FOLDER = 'shift_samples';
        // Static manifest used when opened via file:// so no user action is needed
        const STATIC_SAMPLES = [
            "217386_x4_16x9_hltw_box-213-199-981-655_mos1.14",
            "218358_x4_4x3_hltw_box-299-142-981-655_mos1.29",
            "220035_x4_3x2_hltw_box-213-226-981-744_mos1.43",
            "220207_x4_16x9_hltw_box-43-199-811-655_mos1.0",
            "220347_x4_7x6_hltw_box-43-28-725-598_mos1.36",
            "222804_x4_4x3_hltw_box-299-142-981-655_mos1.79",
            "224003_x4_4x3_hgtw_box-40-43-674-896_mos1.14",
            "230861_x4_16x9_hltw_box-43-142-981-652_mos1.0",
            "232821_x4_2x1_hltw_box-213-24-981-404_mos1.14",
            "234873_x4_16x9_hltw_box-43-29-896-485_mos1.93",
            "238121_x4_7x6_hltw_box-43-103-725-718_mos1.43",
            "239028_x4_3x2_hltw_box-128-32-981-545_mos1.86",
            "244696_x4_7x6_hltw_box-43-29-725-601_mos1.0",
            "244875_x4_3x2_hltw_box-43-85-811-598_mos1.5_rot-7.96",
            "248065_x4_2x1_hltw_box-43-24-811-412_mos1.14",
            "255010_x4_16x9_hltw_box-213-199-981-655_mos1.5",
            "255381_x4_3x2_hltw_box-213-32-981-544_mos1.0",
            "257109_x4_16x9_hltw_box-43-32-981-544_mos1.14",
            "259939_x4_3x2_hltw_box-213-142-981-652_mos1.86",
            "261870_x4_4x3_hgtw_box-93-213-648-896_mos1.64",
            "262993_x4_16x9_hltw_box-213-28-981-484_mos1.93",
            "268918_x4_3x2_hltw_box-213-224-981-736_mos1.93_rot1.4",
            "292390_x4_2x1_hltw_box-43-24-811-408_mos1.86",
            "306179_x4_7x6_hltw_box-299-23-896-525_mos1.43",
            "396172_x4_4x3_hltw_box-299-25-981-533_mos1.5",
            "409275_x4_16x9_hltw_box-43-199-811-655_mos1.14",
            "431180_x4_16x9_hltw_box-213-28-981-484_mos1.71",
            "451263_x4_3x2_hltw_box-128-31-896-519_mos1.21",
            "457466_x4_4x3_hltw_box-299-142-981-655_mos1.79",
            "462746_x4_2x1_hltw_box-128-24-896-408_mos1.5",
        ];

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            const controls = document.querySelector('.controls');
            if (controls) controls.style.display = 'block';
        }

        function hideStatus() {
            const status = document.getElementById('status');
            status.style.display = 'none';
            const controls = document.querySelector('.controls');
            if (controls) controls.style.display = 'none';
        }

        function autoLoadShiftSamples() {
            // ç›´æŽ¥ç”¨é™æ€åˆ—è¡¨ï¼Œæ— è®ºæ˜¯ file:// è¿˜æ˜¯ https://
            const sampleIds = STATIC_SAMPLES.slice();
            const results = sampleIds.map(id => {
                const base = `${DEFAULT_FOLDER}/${encodeURIComponent(id)}`;
                return {
                    id,
                    origPath: `${base}_orig.jpg`,
                    editPath: `${base}_edit.jpg`,
                    reasonUrl: `${base}_reason.txt`,
                    reason: ''
                };
            });
            currentResults = results;
            displayResults(results);
        }

        function displayResults(results) {
            const resultsHtml = results.map(sample => {
                // Truncate very long IDs for display, but keep full ID in tooltip
                const displayId = sample.id.length > 15 ? 
                    `${sample.id.substring(0, 12)}...` : 
                    sample.id;
                
                const isFile = location.protocol === 'file:';
                const reasonBlock = (isFile && sample.reasonUrl)
                    ? `
                        <div class="reason-container">
                            <div class="reason-title">Text Guidance</div>
                            <div class="reason-embed">
                                <iframe class="reason-iframe" src="${sample.reasonUrl}" loading="lazy"></iframe>
                            </div>
                        </div>
                      `
                    : `
                        <div class="reason-container">
                            <div class="reason-title">Text Guidance</div>
                            <textarea class="reason-input" 
                                      id="reason-${sample.id}" 
                                      placeholder="Load reason from file or enter manually..."
                                      onchange="updateSampleReason('${sample.id}', this.value)"></textarea>
                        </div>
                      `;

                return `
                <div class="sample-card">
                    <div class="sample-header">
                        <div class="sample-id" title="Full ID: ${sample.id}">Sample ${displayId}</div>
                    </div>
                    <div class="image-container">
                        <div class="image-wrapper">
                            <img src="${sample.origPath || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY3ODc4Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vdCBGb3VuZDwvdGV4dD48L3N2Zz4='}" alt="Original ${sample.id}">
                            <div class="image-label">Input</div>
                        </div>
                        <div class="image-wrapper">
                            <img src="${sample.editPath || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmY3ODc4Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vdCBGb3VuZDwvdGV4dD48L3N2Zz4='}" alt="Edited ${sample.id}">
                            <div class="image-label">Result</div>
                        </div>
                    </div>
                    ${reasonBlock}
                </div>
                `;
            }).join('');

            document.getElementById('resultsContainer').innerHTML = `
                <div class="results-grid">
                    ${resultsHtml}
                </div>
            `;

            // Load reason texts from URLs (skip fetch in file:// mode)
            results.forEach(sample => {
                if (sample.reasonUrl && location.protocol !== 'file:') {
                    loadReasonFromUrl(sample.id, sample.reasonUrl);
                }
            });
        }

        async function loadReasonFromUrl(sampleId, url) {
            try {
                const res = await fetch(url, { cache: 'no-store' });
                if (!res.ok) return;
                const content = await res.text();
                const textarea = document.getElementById(`reason-${sampleId}`);
                if (textarea) {
                    textarea.value = content;
                    updateSampleReason(sampleId, content);
                }
            } catch (e) {
                // ignore
            }
        }

        function updateSampleReason(sampleId, reason) {
            const sample = currentResults.find(s => s.id === sampleId);
            if (sample) {
                sample.reason = reason;
            }
        }

        function openModal(imagePath) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = imagePath;
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        // Close modal when clicking outside the image
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // Page load initialization
        window.onload = function() {
            autoLoadShiftSamples();
        };
    </script>
</body>
</html> 